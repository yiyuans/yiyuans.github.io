<!DOCTYPE html>
<html lang='en'>

<head>
  <meta name="generator" content="Hexo 6.3.0">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>node博客 - Pursue</title>

  
    <meta name="description" content="创建步骤 因可能用到npm的包，因此创建package.json npm init -y  建立bin文件(可执行文件)，下面创建www.js，作为最开始执行的文件  bin&#x2F;www.js 中主要放置服务器相关代码   在根目录下创建app.js，作为业务代码  将package.json中的入口文件main修改为 &quot;main&quot;: &quot;bin&#x2F;www.js&amp;q">
<meta property="og:type" content="article">
<meta property="og:title" content="node博客">
<meta property="og:url" content="http://example.com/2023/07/29/node%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/index.html">
<meta property="og:site_name" content="Pursue">
<meta property="og:description" content="创建步骤 因可能用到npm的包，因此创建package.json npm init -y  建立bin文件(可执行文件)，下面创建www.js，作为最开始执行的文件  bin&#x2F;www.js 中主要放置服务器相关代码   在根目录下创建app.js，作为业务代码  将package.json中的入口文件main修改为 &quot;main&quot;: &quot;bin&#x2F;www.js&amp;q">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-07-29T05:41:32.000Z">
<meta property="article:modified_time" content="2023-08-08T13:43:42.066Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="node">
<meta name="twitter:card" content="summary">
  
  
  
  <meta name="keywords" content="node">

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  

  

  


  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="http://mms2.baidu.com/it/u=1593296673,2417865956&fm=253&app=138&f=JPEG?w=400&h=400" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">Pursue</div></a></div>

<nav class="menu dis-select"></nav>
</header>


<div class="widgets">
<widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" data-filter="/blog/" placeholder="文章搜索"><svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg></form><div id="search-result"></div><div class="search-no-result">No Results!</div></div></div></widget>


<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">node博客</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B%E4%BB%A3%E7%A0%81"><span class="toc-text">过程代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#createServer%E8%AE%B2%E8%A7%A3"><span class="toc-text">createServer讲解</span></a></li></ol></div></div></widget>




</div>


    </aside>
    <div class='l_main'>
      

      



<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">Home</a><span class="sep"></span><a class="cap breadcrumb" href="/">Blog</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E5%8D%9A%E5%AE%A2/">博客</a></div><div id="post-meta">Posted on&nbsp;<time datetime="2023-07-29T05:41:32.000Z">2023-07-29</time></div></div>

<article class='md-text content post'>
<h1 class="article-title"><span>node博客</span></h1>
<h1 id="创建步骤"><a href="#创建步骤" class="headerlink" title="创建步骤"></a>创建步骤</h1><ol>
<li><p>因可能用到npm的包，因此创建package.json</p>
<p><code>npm init -y</code></p>
</li>
<li><p>建立bin文件(可执行文件)，下面创建<a target="_blank" rel="noopener" href="http://www.js,作为最开始执行的文件/">www.js，作为最开始执行的文件</a></p>
<ul>
<li>bin&#x2F;<a target="_blank" rel="noopener" href="http://www.js/">www.js</a> 中主要放置服务器相关代码</li>
</ul>
</li>
<li><p>在根目录下创建app.js，作为业务代码</p>
</li>
<li><p>将package.json中的入口文件main修改为</p>
<p><code>&quot;main&quot;: &quot;bin/www.js&quot;</code></p>
</li>
<li><p>安装 nodemon </p>
<p><code> npm install nodemon -D</code></p>
<blockquote>
<p>修改npm config, 指向淘宝npm镜像</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">npm</span> config set registry https://registry.npm.taobao.org </span><br><span class="line"><span class="comment"># 官方镜像</span></span><br><span class="line">npm set registry https://registry.npmjs.org/</span><br><span class="line">npm <span class="literal">info</span> underscore （如果上面配置正确这个命令会有字符串response）</span><br></pre></td></tr></table></figure>

<p>npm删除包</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">npm</span> uninstall nodemon</span><br></pre></td></tr></table></figure>
</blockquote>
<ol start="6">
<li><p>把package.json中的scripts做修改</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon bin/www.js&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>nodemon 可以在服务端代码发生改变时，重新执行最新的代码</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行dev </span></span><br><span class="line"><span class="attribute">npm</span> run dev</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h2 id="过程代码"><a href="#过程代码" class="headerlink" title="过程代码"></a>过程代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">serverHandler</span> = (<span class="params">req,res</span>) =&gt; &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> responseData = &#123;</span><br><span class="line">      name : <span class="string">&#x27;bing&#x27;</span>,</span><br><span class="line">      age : <span class="string">&#x27;18&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">end</span>(</span><br><span class="line">      <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(responseData)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = serverHandler</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bin/www.js</span></span><br><span class="line"><span class="comment">// 创建服务器</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> serverHandler = <span class="built_in">require</span>(<span class="string">&#x27;../app&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">5000</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(serverHandler)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;server running at port 5000&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="createServer讲解"><a href="#createServer讲解" class="headerlink" title="createServer讲解"></a>createServer讲解</h2><p>在Node.js中，<code>createServer</code>是一个核心模块<code>http</code>提供的函数，用于创建一个HTTP服务器。它的基本语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.createServer([options], [requestListener])</span><br></pre></td></tr></table></figure>

<p><code>options</code>是一个可选的参数对象，用于配置服务器的一些选项，比如可以指定服务器的主机名、端口号等。</p>
<p><code>requestListener</code>是一个回调函数，用于处理每个客户端请求的逻辑。它接收两个参数：<code>request</code>和<code>response</code>。</p>
<ul>
<li><p><code>request</code>是一个表示客户端请求的可读流，它提供了与请求相关的信息，比如请求的URL、HTTP头部、请求体等。你可以通过监听<code>request</code>的事件（比如<code>data</code>事件）来读取请求的数据，或者通过调用<code>request</code>的方法（比如<code>request.on(&#39;data&#39;, callback)</code>来监听请求数据的传输过程。</p>
</li>
<li><p><code>response</code>是一个表示服务器响应的可写流，你可以通过写入数据到<code>response</code>来发送响应给客户端。你可以设置响应头部信息、写入响应正文，或者通过调用<code>response</code>的方法（比如<code>response.write()</code>、<code>response.end()</code>）来完成响应的发送。</p>
</li>
</ul>
<p><code>createServer</code>函数返回一个<code>http.Server</code>对象，它是一个事件发射器，你可以通过监听它的事件（比如<code>request</code>、<code>connection</code>等）来处理客户端请求或其他与服务器相关的事件。</p>
<p>下面是一个简单的示例，展示如何使用<code>createServer</code>创建一个简单的HTTP服务器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> &#125;);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;Hello, World!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server is running at http://127.0.0.1:3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码创建了一个服务器，监听<code>127.0.0.1</code>的<code>3000</code>端口。当有客户端请求时，服务器会返回一个<code>200</code>状态码和<code>Hello, World!</code>的响应内容。每当有新的请求进来时，会触发<code>request</code>事件，执行回调函数中的逻辑。</p>
<h1 id="初始化路由"><a href="#初始化路由" class="headerlink" title="初始化路由"></a>初始化路由</h1><p>  <strong>主要逻辑：通过 handleBlogRoute(req,res) 将请求传入 blog.js 进行处理</strong></p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> handleBlogRoute = <span class="built_in">require</span>(<span class="string">&#x27;./src/routes/blog&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">serverHandler</span> = (<span class="params">req,res</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 设置响应格式</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> url = req.<span class="property">url</span></span><br><span class="line">    <span class="comment">// 将path挂在req对象上，方便访问</span></span><br><span class="line">    req.<span class="property">path</span> = url.<span class="title function_">split</span>(<span class="string">&#x27;?&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> blogData = <span class="title function_">handleBlogRoute</span>(req,res)</span><br><span class="line">    <span class="keyword">if</span> (blogData)&#123;</span><br><span class="line">        <span class="comment">// 结束请求 返回响应</span></span><br><span class="line">        res.<span class="title function_">end</span>(</span><br><span class="line">            <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(blogData)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 若没有命中blog的路由</span></span><br><span class="line">    <span class="comment">// 设置状态码，覆盖返回类型</span></span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">404</span>,&#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;text/plain&#x27;</span>&#125;)</span><br><span class="line">    res.<span class="title function_">write</span>(<span class="string">&#x27;404 Not Found&#x27;</span>)</span><br><span class="line">    res.<span class="title function_">end</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = serverHandler</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// blog.js</span></span><br><span class="line"><span class="comment">// 处理博客相关路由</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBlogRoute</span> = (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 定义处理路由的逻辑</span></span><br><span class="line">    <span class="keyword">const</span> method = req.<span class="property">method</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;GET&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/list&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;获取博客列表的接口&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;GET&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/detail&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27; 获取博客详情的接口&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/new&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27; 新建博客的接口&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/update&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27; 更新博客的接口&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/delete&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27; 删除博客列表的接口&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = handleBlogRoute</span><br></pre></td></tr></table></figure>

<h1 id="开发第一个路由"><a href="#开发第一个路由" class="headerlink" title="开发第一个路由"></a>开发第一个路由</h1><ul>
<li><p>src</p>
<ul>
<li><p>controllers</p>
<ul>
<li>blog.js</li>
</ul>
</li>
<li><p>model</p>
<ul>
<li>responseModel.js</li>
</ul>
</li>
<li><p>routes</p>
<ul>
<li>blog.js</li>
</ul>
</li>
</ul>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/blog.js</span></span><br><span class="line"><span class="comment">// 处理博客相关路由</span></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="title class_">SuccessModel</span>&#125; = <span class="built_in">require</span>(<span class="string">&#x27;../model/responseModel&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123;getList&#125; = <span class="built_in">require</span>(<span class="string">&#x27;../controllers/blog&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBlogRoute</span> = (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 定义处理路由的逻辑</span></span><br><span class="line">    <span class="keyword">const</span> method = req.<span class="property">method</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;GET&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/list&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// /api/blog/list?author=zhangsan&amp;keyword=123</span></span><br><span class="line">        <span class="comment">// new SuccessModel()</span></span><br><span class="line">        <span class="keyword">const</span> author = req.<span class="property">query</span>.<span class="property">author</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">// 获取不到时为 &#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">const</span> keyword = req.<span class="property">query</span>.<span class="property">keyword</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">const</span> listData = <span class="title function_">getList</span>(author,keyword)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SuccessModel</span>(listData)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// return &#123;</span></span><br><span class="line">        <span class="comment">//     message: &#x27;获取博客列表的接口&#x27;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;GET&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/detail&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27; 获取博客详情的接口&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/new&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27; 新建博客的接口&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/update&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27; 更新博客的接口&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/delete&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27; 删除博客列表的接口&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = handleBlogRoute</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// responseModel.js</span></span><br><span class="line"><span class="comment">// 规范化响应数据</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseModel</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">data, message</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">message</span> = data</span><br><span class="line">            data = <span class="literal">null</span></span><br><span class="line">            message = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (data)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">data</span> = data</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (message)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">message</span> = message</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这段代码定义了一个名为`SuccessModel`的类，继承自`BaseModel`。</span></span><br><span class="line"><span class="comment">// `constructor`函数是类的构造函数，当通过`new SuccessModel()`创建对象时，会自动调用该函数进行对象的初始化。它接收两个参数`data`和`message`，代表数据和消息。</span></span><br><span class="line"><span class="comment">// `super(data, message)`是调用父类`BaseModel`的构造函数，并将传入的`data`和`message`作为参数传递给父类的构造函数，以初始化继承的属性。</span></span><br><span class="line"><span class="comment">// `this.errno = 0`是给当前对象添加一个新的属性`errno`，并为其赋值为0。</span></span><br><span class="line"><span class="comment">// 综上，这段代码的作用是创建一个`SuccessModel`对象，通过调用父类的构造函数初始化继承的属性，然后为该对象添加一个`errno`属性并赋值为0。通常用于表示操作成功的返回模型。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SuccessModel</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseModel</span> &#123;  <span class="comment">//成功接收模型</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">data, message</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(data, message)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">errno</span> = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//失败接收模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorModel</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseModel</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">data,message</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(data,message)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">errno</span> = -<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="title class_">SuccessModel</span>,</span><br><span class="line">    <span class="title class_">ErrorModel</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controllers/blog.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getList</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 先定义假数据</span></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;标题1&#x27;</span>,</span><br><span class="line">            <span class="attr">content</span>: <span class="string">&#x27;内容1&#x27;</span>,</span><br><span class="line">            <span class="attr">author</span>: <span class="string">&#x27;zhangsan&#x27;</span>,</span><br><span class="line">            <span class="attr">createdAt</span>: <span class="number">1610555518935</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;标题2&#x27;</span>,</span><br><span class="line">            <span class="attr">content</span>: <span class="string">&#x27;内容2&#x27;</span>,</span><br><span class="line">            <span class="attr">author</span>: <span class="string">&#x27; lisi &#x27;</span>,</span><br><span class="line">            <span class="attr">createdAt</span>: <span class="number">1610555535044</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    getList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="处理异步代码"><a href="#处理异步代码" class="headerlink" title="处理异步代码"></a>处理异步代码</h1><p><em><em>req.on</em>(data)指每次发送的数据；req.on(<em>end</em>)数据发送完成</em>*</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取data中的json数据</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>) <span class="comment">// fs:用来读取文件</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="comment">// promise 实现 读取文件内容</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getFileContent</span>(<span class="params">filename</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 数据文件的绝对路径</span></span><br><span class="line">        <span class="keyword">const</span> fullFilename = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;data&#x27;</span>, filename)</span><br><span class="line">        <span class="comment">// 在函数内部，使用path.resolve(__dirname, &#x27;data&#x27;, filename)的方式组合了一个完整的文件路径，__dirname代表当前脚本所在的目录，data是一个子目录，filename是要读取的文件名。通过这个方式，可以得到要读取文件的完整路径fullFilename。</span></span><br><span class="line">        fs.<span class="title function_">readFile</span>(fullFilename, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">resolve</span>(</span><br><span class="line">                <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data.<span class="title function_">toString</span>())  <span class="comment">//转为json对象</span></span><br><span class="line">            );</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getFileContent</span>(<span class="string">&#x27;a.json&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">aData</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;aData&#x27;</span>,aData);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getFileContent</span>(aData.<span class="property">next</span>)  <span class="comment">//相当于返回一个promise</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">bData</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;bData&#x27;</span>,bData)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getFileContent</span>(bData.<span class="property">next</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">cData</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;cData&#x27;</span>,cData);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// Promise常用来处理异步代码 如POST请求</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// if(req.method === &#x27;POST&#x27;)&#123;</span></span><br><span class="line"><span class="comment">//     let postData = &#x27;&#x27;</span></span><br><span class="line"><span class="comment">//     // 接收数据流</span></span><br><span class="line"><span class="comment">//     req.on(&#x27;data&#x27;,chunk=&gt;&#123;</span></span><br><span class="line"><span class="comment">//         postData += chunk.toString()</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     req.on(&#x27;end&#x27;,()=&gt;&#123;</span></span><br><span class="line"><span class="comment">//         console.log(&#x27;postData&#x27;,postData);</span></span><br><span class="line"><span class="comment">//         req.end(&#x27;数据接收完毕&#x27;)</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="处理POST数据"><a href="#处理POST数据" class="headerlink" title="处理POST数据"></a>处理POST数据</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> handleBlogRoute = <span class="built_in">require</span>(<span class="string">&#x27;./src/routes/blog&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理POST数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getPostData</span> = (<span class="params">req</span>) =&gt; &#123;   <span class="comment">// req 接收请求参数</span></span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 判断是否为post请求</span></span><br><span class="line">        <span class="keyword">if</span> (req.<span class="property">method</span> !== <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(&#123;&#125;)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断是否为json格式</span></span><br><span class="line">        <span class="keyword">if</span> (req.<span class="property">headers</span>[<span class="string">&#x27;content-type&#x27;</span>] !== <span class="string">&#x27;application/json&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 头部字段名(content-type)是不区分大小写的。</span></span><br><span class="line">            <span class="title function_">resolve</span>(&#123;&#125;)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 接收post数据</span></span><br><span class="line">        <span class="keyword">let</span> postData = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">chunk</span> =&gt;</span> &#123;</span><br><span class="line">            postData += chunk.<span class="title function_">toString</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">        req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!postData) &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(&#123;&#125;)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">resolve</span>(</span><br><span class="line">                <span class="title class_">JSON</span>.<span class="title function_">parse</span>(postData)</span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">serverHandler</span> = (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 设置响应格式</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">    <span class="comment">// 获取path</span></span><br><span class="line">    <span class="keyword">const</span> url = req.<span class="property">url</span></span><br><span class="line">    <span class="comment">// 将path挂在req对象上，方便访问</span></span><br><span class="line">    req.<span class="property">path</span> = url.<span class="title function_">split</span>(<span class="string">&#x27;?&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析 query</span></span><br><span class="line">    req.<span class="property">query</span> = querystring.<span class="title function_">parse</span>(url.<span class="title function_">split</span>(<span class="string">&#x27;?&#x27;</span>)[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getPostData</span>(req).<span class="title function_">then</span>(<span class="function">(<span class="params">postData</span>) =&gt;</span> &#123;</span><br><span class="line">        req.<span class="property">body</span> = postData</span><br><span class="line">        <span class="comment">// 博客相关路由</span></span><br><span class="line">        <span class="keyword">const</span> blogData = <span class="title function_">handleBlogRoute</span>(req, res)</span><br><span class="line">        <span class="keyword">if</span> (blogData) &#123;</span><br><span class="line">            <span class="comment">// 结束请求 返回响应</span></span><br><span class="line">            res.<span class="title function_">end</span>(</span><br><span class="line">                <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(blogData)</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 若没有匹配到任何blog的路由</span></span><br><span class="line">        <span class="comment">// 设置状态码，覆盖返回类型</span></span><br><span class="line">        res.<span class="title function_">writeHead</span>(<span class="number">404</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> &#125;)</span><br><span class="line">        res.<span class="title function_">write</span>(<span class="string">&#x27;404 Not Found&#x27;</span>)</span><br><span class="line">        res.<span class="title function_">end</span>()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = serverHandler</span><br></pre></td></tr></table></figure>

<h1 id="开发新建、更新、删除博客的路由"><a href="#开发新建、更新、删除博客的路由" class="headerlink" title="开发新建、更新、删除博客的路由"></a>开发新建、更新、删除博客的路由</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 新增博客路由</span></span><br><span class="line"><span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/new&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newBlogData = <span class="title function_">creatNewBlog</span>(blogData)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27; 新建博客的接口&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更新博客路由</span></span><br><span class="line"><span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/update&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(req.body);</span></span><br><span class="line">    <span class="keyword">const</span> updatadBlogData = <span class="title function_">updataBlog</span>(id, blogData)</span><br><span class="line">    <span class="keyword">if</span> (updatadBlogData)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SuccessModel</span>(<span class="string">&#x27;更新博客成功&#x27;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ErrorModel</span>(<span class="string">&#x27;更新博客失败...&#x27;</span>)</span><br><span class="line">    &#125;      </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除博客路由</span></span><br><span class="line"><span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/delete&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> deleteBlogData = <span class="title function_">deleteBlog</span>(id)</span><br><span class="line">    <span class="keyword">if</span> (deleteBlogData)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SuccessModel</span>(<span class="string">&#x27;删除博客成功&#x27;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ErrorModel</span>(<span class="string">&#x27;删除博客失败...&#x27;</span>)</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="用docker创建mysql"><a href="#用docker创建mysql" class="headerlink" title="用docker创建mysql"></a>用docker创建mysql</h1><ol>
<li><p><strong>创建卷</strong></p>
<p>默认情况下，MySQL 将其数据文件存储在该 <code>/var/lib/myblog</code> 目录中。因此，在部署之前，您需要设置一个 Docker 卷来持久化您的数据库。否则，当容器重新启动时，您的数据将丢失。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">volume</span><span class="language-bash"> create myblog</span></span><br><span class="line"><span class="comment"># 检查volume</span></span><br><span class="line">docker <span class="keyword">volume</span><span class="language-bash"> <span class="built_in">ls</span> </span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>运行一个 MySQL Docker 容器</strong></p>
 <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -d --name=myblog -p 3306:3306 -v myblog:/var/lib/myblog -e MYSQL_ROOT_PASSWORD=123456 -e LANG=<span class="string">&quot;C.UTF-8&quot;</span> mysql:5</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>-d</code> 将以分离模式运行此容器，以便它在后台运行。</p>
</li>
<li><p><code>--name</code> 将名称分配<code>mysql-server</code>给您的容器实例。如果不指定此项，Docker 将生成一个随机名称。</p>
</li>
<li><p><code>-p</code> 将 MySQL 容器端口绑定<code>3306</code>到主机上的相同端口。您将能够 使用在您的主机上运行的MySQL 客户端 ( )连接到 <code>127.0.0.1</code>端口。<code>3306``mysql</code></p>
</li>
<li><p><code>-v</code> 选项将容器卷 ( <code>/var/lib/mysql</code>)内的数据文件夹绑定到<code>mysql-data</code>您在上一步中创建的本地 Docker 卷 ( )。</p>
</li>
<li><p><code>-e</code> 设置环境变量。在这种情况下，MySQL 根密码。</p>
</li>
<li><p><code>mysql</code> 是我们用来创建容器的图像的名称。</p>
<blockquote>
<p><strong>docker 的 mysql 容器不能输入中文解决方法：</strong></p>
<ol>
<li><p>构建docker 容器时候增加一个变量 -e LANG&#x3D;C.UTF-8 </p>
</li>
<li><p>持久修改-docker-compose.yml</p>
<p>docker-compose.yml添加如下配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">environment:</span><br><span class="line">    TZ: <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    LANG: en_US.UTF-8</span><br><span class="line">    volumes:</span><br><span class="line">    - /etc/localtime:/etc/localtime:ro</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_13849441/5073579?share_token=d9184312-14e6-4254-8094-13f81e74f74a">https://blog.51cto.com/u_13849441/5073579?share_token=d9184312-14e6-4254-8094-13f81e74f74a</a></p>
</li>
<li><p>要永久修改需在创建镜像时在Dockerfile中设置。持久修改-Dockerfile<br>在Dockerfile中添加一行 ENV LANG C.UTF-8 ，重新制作Mysql镜像</p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/wangshiqi666/article/details/130498331?share_token=e1936136-7190-4a79-a7f2-3c86dd1e1f03">https://blog.csdn.net/wangshiqi666/article/details/130498331?share_token=e1936136-7190-4a79-a7f2-3c86dd1e1f03</a></p>
 <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> mysql:<span class="number">8.0</span></span><br><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
</li>
</ul>
<hr>
<p> 可以通过列出正在运行的容器来检查容器是否正在运行：</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>连接到 MySQL 容器</strong></p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it myblog mysql -u root -p123456 --default-character-set=utf8mb4</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>停止、启动和重启 MySQL 容器</strong></p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker stop myblog</span><br><span class="line">docker start myblog</span><br><span class="line">docker restart myblog</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据库操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 1.创建数据库</span><br><span class="line">CREATE DATABASE myblog;</span><br><span class="line"># 2.选择数据库</span><br><span class="line">USE 数据库名;</span><br><span class="line">USE myblog;</span><br><span class="line"># 3.创建表格</span><br><span class="line">CREATE TABLE 表格名 (</span><br><span class="line">   列1 数据类型,</span><br><span class="line">   列2 数据类型,</span><br><span class="line">   .....</span><br><span class="line">   列N 数据类型</span><br><span class="line">);</span><br><span class="line"># 可将2 3步骤写为：</span><br><span class="line">CREATE TABLE myblog . blogs (</span><br><span class="line">   id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">   title VARCHAR(50) NOT NULL,</span><br><span class="line">   content LONGTEXT NOT NULL,</span><br><span class="line">   author VARCHAR(20) NOT NULL,</span><br><span class="line">   createdAt BIGINT(20) NOT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8; </span><br><span class="line"># 设置字符集为utf8</span><br><span class="line">-- 用两个--注释mysql语句</span><br></pre></td></tr></table></figure>

<p>LONGTEXT：表示可存更多的数据</p>
<p>BIGINT()：表示更大的整数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 4.向数据库中插入数据</span><br><span class="line">use myblog;</span><br><span class="line">-- show tables;</span><br><span class="line">insert into blogs(title,content,author,createdAt) values (&#x27;标题1&#x27;,&#x27;内容1&#x27;,&#x27;bing&#x27;,&#x27;1234567890123&#x27;);</span><br></pre></td></tr></table></figure>

<p><strong>登录MySQL数据库，通过<code>show variables like &#39;character%&#39;;</code> 查看编码格式</strong></p>
</li>
</ol>
<h1 id="mysql-常见的数据表命令行操作"><a href="#mysql-常见的数据表命令行操作" class="headerlink" title="mysql 常见的数据表命令行操作"></a>mysql 常见的数据表命令行操作</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. **创建表：**</span><br><span class="line">   CREATE TABLE users (</span><br><span class="line">     id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">     username VARCHAR(50) NOT NULL,</span><br><span class="line">     pwd VARCHAR(50) NOT NULL</span><br><span class="line">   ) ENGINE=InnoDB DEFAULT CHARSET=utf8; </span><br></pre></td></tr></table></figure>


   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2. 查看表结构：DESC &lt;表名&gt;;</span><br></pre></td></tr></table></figure>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3. 插入数据： INSERT INTO &lt;表名&gt; (&lt;列1&gt;, &lt;列2&gt;, ...) VALUES (&lt;值1&gt;, &lt;值2&gt;, ...);</span><br><span class="line">	示例： INSERT INTO users (id, name, age) VALUES (1, &#x27;John&#x27;, 25);</span><br></pre></td></tr></table></figure>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">4. 查询数据： SELECT &lt;列1&gt;, &lt;列2&gt;, ... FROM &lt;表名&gt; WHERE &lt;条件&gt;;</span><br><span class="line">	示例：	SELECT name, age FROM users WHERE id = 1;</span><br><span class="line">   		mysql&gt; select * from blogs where id=1;</span><br><span class="line">   - 模糊查询： select * from blogs where title like &#x27;%模糊查询内容%&#x27;;</span><br><span class="line">   - 根据id进行排序： order by id</span><br><span class="line">   - 倒序： desc</span><br></pre></td></tr></table></figure>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5. 更新数据： UPDATE &lt;表名&gt; SET &lt;列1&gt; = &lt;新值1&gt;, &lt;列2&gt; = &lt;新值2&gt; WHERE &lt;条件&gt;;</span><br><span class="line">	示例： UPDATE blogs set title = &#x27;标题&#x27; WHERE id = 1;</span><br></pre></td></tr></table></figure>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">6. 删除</span><br><span class="line">	- 删除数据： DELETE FROM &lt;表名&gt; WHERE &lt;条件&gt;;</span><br><span class="line">		示例：  DELETE FROM blogs WHERE title = &#x27;标题2&#x27;;</span><br><span class="line">	- 删除表： DROP TABLE &lt;表名&gt;;</span><br><span class="line">		示例：   DROP TABLE users;</span><br><span class="line">	- 软删除</span><br><span class="line">        - select * from blogs where state=&#x27;1&#x27;; -- 软删除</span><br><span class="line">        - update blogs set state=&#x27;1&#x27; where author=&#x27;zhangsan&#x27;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">7. ALTER 用法：</span><br><span class="line">	- 添加字段 alter table + 表的名字 add + 字段名 + 字段类型</span><br><span class="line">		示例： alter table blogs add state int null default 1 after `createdAt`;</span><br><span class="line">	- 删除字段 alter table + 表的名字 drop + 删除的字段名</span><br><span class="line">		示例： alter table blogs drop state;</span><br><span class="line">	- 修改字段的数据类型    modify</span><br><span class="line">		alter table 表名 modify 字段名 新数据类型;</span><br><span class="line">		alter table users modify id INT PRIMARY KEY AUTO_INCREMENT;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">8. 不等号 &lt;&gt;</span><br><span class="line">	- select * from blogs where state&lt;&gt;&#x27;1&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">9. 使用SHOW TABLES查询所有表的名称</span><br><span class="line">	- SHOW TABLES;</span><br><span class="line">	使用SELECT * FROM查询表数据</span><br><span class="line">	- SHOW TABLES 表名;</span><br></pre></td></tr></table></figure>



<h1 id="nodejs-连接-mysql"><a href="#nodejs-连接-mysql" class="headerlink" title="nodejs 连接 mysql"></a>nodejs 连接 mysql</h1><ol>
<li>创建 mysql-demo 文件夹 ，cd到该路径，执行 npm init -y 进行初始化</li>
<li>安装mysql的工具，执行 npm install mysql</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// Node.js 连接 mysql</span><br><span class="line">const mysql = require(&#x27;mysql&#x27;)</span><br><span class="line"></span><br><span class="line">// 创建连接对象</span><br><span class="line">const connection = mysql.createConnection(&#123;</span><br><span class="line">    host:&#x27;localhost&#x27;,</span><br><span class="line">    user:&#x27;root&#x27;,</span><br><span class="line">    password:&#x27;123456&#x27;,</span><br><span class="line">    port:&#x27;3306&#x27;, //默认端口</span><br><span class="line">    database:&#x27;myblog&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 开始连接</span><br><span class="line">connection.connect()</span><br><span class="line"></span><br><span class="line">// 执行sql语句</span><br><span class="line">const sql = `select * from blogs` // 反引号</span><br><span class="line">connection.query(sql,(err,result)=&gt;&#123;</span><br><span class="line">    if (err)&#123;</span><br><span class="line">        console.error(&#x27;error&#x27;,err);</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(result);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 关闭连接</span><br><span class="line">connection.end()</span><br></pre></td></tr></table></figure>

<h1 id="封装执行-sql-语句的函数"><a href="#封装执行-sql-语句的函数" class="headerlink" title="封装执行 sql 语句的函数"></a>封装执行 sql 语句的函数</h1><p><strong>将配置参数写入config中，方便修改配置</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/config/db.js </span></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">MYSQL_CONFIG</span> = &#123;&#125;</span><br><span class="line"><span class="variable constant_">MYSQL_CONFIG</span> = &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="string">&#x27;3306&#x27;</span>, <span class="comment">//默认端口</span></span><br><span class="line">    <span class="attr">database</span>: <span class="string">&#x27;myblog&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="variable constant_">MYSQL_CONFIG</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>采用promise操作</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from blogs`</span> <span class="comment">// 反引号</span></span><br><span class="line"><span class="title function_">execSQL</span>(sql).<span class="title function_">then</span>(<span class="function"><span class="params">result</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;result&#x27;</span>,result)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>修改js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/db/mysql.js</span></span><br><span class="line"><span class="comment">// Node.js 连接 mysql</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">MYSQL_CONFIG</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../config/db&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建连接对象</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.<span class="title function_">createConnection</span>(<span class="variable constant_">MYSQL_CONFIG</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始连接</span></span><br><span class="line">connection.<span class="title function_">connect</span>()</span><br><span class="line"><span class="comment">// 执行sql语句</span></span><br><span class="line"><span class="comment">// promise</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">execSQL</span>(<span class="params">sql</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        connection.<span class="title function_">query</span>(sql, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">resolve</span>(result)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    execSQL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="博客列表接口对接mysql"><a href="#博客列表接口对接mysql" class="headerlink" title="博客列表接口对接mysql"></a>博客列表接口对接mysql</h1><p><strong>controllers代码更改</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;execSQL&#125; = <span class="built_in">require</span>(<span class="string">&#x27;../db/mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取博客列表数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getBlogsList</span> = (<span class="params">author, keyword</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">`select * from blogs where 1=1`</span> <span class="comment">// 反引号  加 1=1 是为了防止author不存在时报错</span></span><br><span class="line">    <span class="keyword">if</span>(author)&#123;</span><br><span class="line">        sql+=<span class="string">` and author=&#x27;<span class="subst">$&#123;author&#125;</span>&#x27;`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(keyword)&#123;</span><br><span class="line">        sql+=<span class="string">` and title like &#x27;%<span class="subst">$&#123;keyword&#125;</span>%&#x27;`</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">execSQL</span>(sql)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>修改处理路由的逻辑</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (method === <span class="string">&#x27;GET&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/list&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// /api/blog/list?author=zhangsan&amp;keyword=123</span></span><br><span class="line">    <span class="comment">// new SuccessModel()</span></span><br><span class="line">    <span class="keyword">const</span> author = req.<span class="property">query</span>.<span class="property">author</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">// 获取不到时为 &#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> keyword = req.<span class="property">query</span>.<span class="property">keyword</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> listDataPromise = <span class="title function_">getBlogsList</span>(author, keyword)  <span class="comment">//返回为promise类型</span></span><br><span class="line">    <span class="keyword">return</span> listDataPromise.<span class="title function_">then</span>(<span class="function"><span class="params">listData</span> =&gt;</span> &#123; <span class="comment">// 最终返回promise</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SuccessModel</span>(listData)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>app.js中修改</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getPostData</span>(req).<span class="title function_">then</span>(<span class="function">(<span class="params">postData</span>) =&gt;</span> &#123;</span><br><span class="line">    req.<span class="property">body</span> = postData</span><br><span class="line">    <span class="comment">// 博客相关路由</span></span><br><span class="line">    <span class="keyword">const</span> blogDataPromise = <span class="title function_">handleBlogRoute</span>(req, res)</span><br><span class="line">    <span class="keyword">if</span> (blogDataPromise) &#123;  <span class="comment">// 结束请求 返回响应</span></span><br><span class="line">        blogDataPromise.<span class="title function_">then</span>(<span class="function"><span class="params">blogData</span> =&gt;</span> &#123;</span><br><span class="line">            res.<span class="title function_">end</span>(</span><br><span class="line">                <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(blogData)</span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 若没有匹配到任何blog的路由</span></span><br><span class="line">    <span class="comment">// 设置状态码，覆盖返回类型</span></span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">404</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> &#125;)</span><br><span class="line">    res.<span class="title function_">write</span>(<span class="string">&#x27;404 Not Found&#x27;</span>)</span><br><span class="line">    res.<span class="title function_">end</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="博客详情和新建博客接口"><a href="#博客详情和新建博客接口" class="headerlink" title="博客详情和新建博客接口"></a>博客详情和新建博客接口</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建博客</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">creatNewBlog</span> = (<span class="params">blogData = &#123;&#125;</span>) =&gt; &#123; <span class="comment">// 给blogData设置一个空对象</span></span><br><span class="line">    <span class="comment">// blogData: title content author createdAt</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;blogData&#x27;, blogData);</span></span><br><span class="line">    <span class="keyword">const</span> title = blogData.<span class="property">title</span></span><br><span class="line">    <span class="keyword">const</span> content = blogData.<span class="property">content</span></span><br><span class="line">    <span class="keyword">const</span> author = blogData.<span class="property">author</span></span><br><span class="line">    <span class="keyword">const</span> createdAt = <span class="title class_">Date</span>.<span class="title function_">now</span>()  <span class="comment">//获取时间戳</span></span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`insert into blogs (title,content,author,createdAt) values (&#x27;<span class="subst">$&#123;title&#125;</span>&#x27; , &#x27;<span class="subst">$&#123;content&#125;</span>&#x27; , &#x27;<span class="subst">$&#123;author&#125;</span>&#x27; , <span class="subst">$&#123;createdAt&#125;</span>)`</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">execSQL</span>(sql).<span class="title function_">then</span>(<span class="function"><span class="params">insertedResult</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;insertedResult&#x27;</span>, insertedResult);</span><br><span class="line">        <span class="keyword">return</span> insertedResult.<span class="property">insertId</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增博客路由</span></span><br><span class="line"><span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/new&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// const newBlogData = creatNewBlog(blogData)</span></span><br><span class="line">    <span class="comment">// return &#123;</span></span><br><span class="line">    <span class="comment">//     message: &#x27; 新建博客的接口&#x27;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">const</span> author = <span class="string">&#x27;bing&#x27;</span></span><br><span class="line">    req.<span class="property">body</span>.<span class="property">author</span> = author</span><br><span class="line">    <span class="keyword">const</span> newBlogDataPromise = <span class="title function_">creatNewBlog</span>(blogData)</span><br><span class="line">    <span class="keyword">return</span> newBlogDataPromise.<span class="title function_">then</span>(<span class="function"><span class="params">newBlogData</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SuccessModel</span>(newBlogData)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="更新和删除博客"><a href="#更新和删除博客" class="headerlink" title="更新和删除博客"></a>更新和删除博客</h1><p><strong>routes&#x2F;blogs</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新博客路由</span></span><br><span class="line"><span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/update&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> updatadBlogPrimose = <span class="title function_">updataBlog</span>(id, blogData)</span><br><span class="line">    <span class="comment">// return updatadBlogPrimose.then(updatadBlogData=&gt;console.log(updataBlog))</span></span><br><span class="line">    <span class="keyword">return</span> updatadBlogPrimose.<span class="title function_">then</span>(<span class="function"><span class="params">updatadBlogData</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (updatadBlogData) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SuccessModel</span>(<span class="string">&#x27;更新博客成功&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ErrorModel</span>(<span class="string">&#x27;更新博客失败...&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除博客路由</span></span><br><span class="line"><span class="keyword">if</span> (method === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/api/blog/delete&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> author = <span class="string">&#x27;bing&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> deleteBlogPromise = <span class="title function_">deleteBlog</span>(id, author)</span><br><span class="line">    <span class="keyword">return</span> deleteBlogPromise.<span class="title function_">then</span>(<span class="function"><span class="params">deleteBlogData</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (deleteBlogData) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SuccessModel</span>(<span class="string">&#x27;删除博客成功&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ErrorModel</span>(<span class="string">&#x27;删除博客失败...&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>controllers&#x2F;blogs</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新博客</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">updataBlog</span> = (<span class="params">id, blogData = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> title = blogData.<span class="property">title</span></span><br><span class="line">    <span class="keyword">const</span> content = blogData.<span class="property">content</span></span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`update blogs set title=&#x27;<span class="subst">$&#123;title&#125;</span>&#x27; , content=&#x27;<span class="subst">$&#123;content&#125;</span>&#x27; where id = <span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">execSQL</span>(sql).<span class="title function_">then</span>(<span class="function"><span class="params">upDateResult</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(&#x27;upDateResult&#x27;,upDateResult);</span></span><br><span class="line">        <span class="keyword">if</span> (upDateResult.<span class="property">affectedRows</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除博客</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">deleteBlog</span> = (<span class="params">id, author</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`delete from blogs where id = <span class="subst">$&#123;id&#125;</span> and author = &#x27;<span class="subst">$&#123;author&#125;</span>&#x27;`</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">execSQL</span>(sql).<span class="title function_">then</span>(<span class="function"><span class="params">deleteResult</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(blogData);</span></span><br><span class="line">        <span class="keyword">if</span> (deleteResult.<span class="property">affectedRows</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="cookie-和-session-入门"><a href="#cookie-和-session-入门" class="headerlink" title="cookie 和 session 入门"></a>cookie 和 session 入门</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录 cookie</span></span><br><span class="line">req.<span class="property">query</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> cookieStr = req.<span class="property">headers</span>.<span class="property">cookie</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (method === <span class="string">&#x27;GET&#x27;</span> &amp;&amp; req.<span class="property">path</span> === <span class="string">&#x27;/user/login&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">//cookie: username=bing;age=15</span></span><br><span class="line">    <span class="keyword">if</span> (!cookieStr) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        cookieStr.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!item) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(&#123;&#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> arr = item.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">            <span class="keyword">const</span> key = arr[<span class="number">0</span>].<span class="title function_">trim</span>()  <span class="comment">// 去除空格</span></span><br><span class="line">            <span class="keyword">const</span> val = arr[<span class="number">1</span>].<span class="title function_">trim</span>()</span><br><span class="line">            req.<span class="property">query</span>[key] = val</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">query</span>))</span><br><span class="line">        <span class="comment">// console.log(JSON.stringify(req.query));</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h1 id="服务端设置cookie"><a href="#服务端设置cookie" class="headerlink" title="服务端设置cookie"></a>服务端设置cookie</h1><ul>
<li><p>path : 设置cookie的路径</p>
</li>
<li><p>expires : cookie有效期</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">function</span> <span class="title function_">serCookieExpireTime</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">        date.<span class="title function_">setTime</span>(date.<span class="title function_">getTime</span>() + <span class="number">10</span> * <span class="number">1000</span>)  <span class="comment">// 设置10s的有效期</span></span><br><span class="line">        <span class="keyword">return</span> date.<span class="title function_">toGMTString</span>() <span class="comment">// 转格式</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">req.<span class="title function_">setHeader</span>(<span class="string">&#x27;set-Cookie&#x27;</span>, <span class="string">`username=xin;path=/;expires=&#x27;<span class="subst">$&#123;serCookieExpireTime()&#125;</span>&#x27;`</span>)</span><br></pre></td></tr></table></figure>




<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>License</span></div><div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">Newer</div><a href="/2023/07/29/hexo%E6%90%AD%E5%BB%BA/">hexo搭建</a></div><div class="item" id="next"><div class="note">Older</div><a href="/2023/07/29/hello-world/">Hello World</a></div></section></div>








      
<footer class="page-footer reveal fs12"><hr><div class="text"><p>本站由 <a href="/">@anonymity</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = stellar.config.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.19.0';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0';
  stellar.config = {
    date_suffix: {
      just: 'Just',
      min: 'minutes ago',
      hour: 'hours ago',
      day: 'days ago',
      month: 'months ago',
    },
    root : '/',
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.copycode = Object.assign({"enable":true,"js":"/js/plugins/copycode.js","default_text":"Copy","success_text":"Copied"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
